{"version":3,"sources":["../server/index.js"],"names":["require","version","express","morgan","cors","bodyParser","_","ObjectID","mongoose","Todo","User","authenticate","app","port","process","env","PORT","use","exposedHeaders","json","get","req","res","post","todo","text","body","_creator","user","_id","save","then","send","catch","err","status","find","todos","id","params","isValid","findOne","console","log","delete","findOneAndRemove","patch","pick","isBoolean","completed","completedAt","Date","getTime","findOneAndUpdate","$set","new","generateAuthToken","token","header","email","password","findByCredentials","removeToken","listen","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["require('./config/config');\n\nconst {version} = require('./../package.json');\nconst express = require('express');\nconst morgan = require('morgan');\nconst cors = require('cors');\nconst bodyParser = require('body-parser');\nconst _ = require('lodash');\nconst {ObjectID} = require('mongodb');\n\nconst {mongoose} = require('./db/mongoose'); // eslint-disable-line\nconst {Todo} = require('./models/Todo');\nconst {User} = require('./models/User');\nconst {authenticate} = require('./middleware/authenticate');\n\nconst app = express();\n\nconst port = process.env.PORT || 3000;\n\napp.use(morgan('dev'));\n\napp.use(cors({ exposedHeaders: [\"Link\"] }));\n\napp.use(bodyParser.json());\n\napp.get('/', (req, res) => {\n\tres.json({ version });\n});\n\napp.post('/todos', authenticate, (req, res) => {\n\tconst todo = new Todo({\n\t\ttext: req.body.text,\n\t\t_creator: req.user._id\n\t});\n\n\ttodo.save()\n\t.then((todo) => {\n\t\tres.send({todo});\n\t})\n\t.catch((err) => {\n\t\tres.status(400).send(err);\n\t});\n});\n\napp.get('/todos', authenticate, (req, res) => {\n\tTodo.find({\n\t\t_creator: req.user._id\n\t})\n\t.then((todos) => {\n\t\tres.send({todos});\n\t})\n\t.catch((err) => {\n\t\tres.status(400).send(err);\n\t});\n});\n\napp.get('/todos/:id', authenticate, (req, res) => {\n\tconst {id} = req.params;\n\n\tif (!ObjectID.isValid(id)) {\n\t\treturn res.status(404).send();\n\t}\n\n\tTodo.findOne({\n\t\t_id: id,\n\t\t_creator: req.user._id\n\t})\n\t.then((todo) => {\n\t\tif (todo) {\n\t\t\tres.send({todo});\n\t\t} else {\n\t\t\tres.status(404).send();\n\t\t}\n\t})\n\t.catch((err) => {\n\t\tconsole.log(err);\n\t\tres.status(400).send();\n\t});\n\n});\n\napp.delete('/todos/:id', authenticate, (req, res) => {\n\tconst {id} = req.params;\n\n\tif (!ObjectID.isValid(id)) {\n\t\treturn res.status(404).send();\n\t}\n\n\tTodo.findOneAndRemove({\n\t\t_id: id,\n\t\t_creator: req.user._id\n\t})\n\t.then((todo) => {\n\t\tif (todo) {\n\t\t\tres.send({todo});\n\t\t} else {\n\t\t\tres.status(404).send();\n\t\t}\n\t})\n\t.catch((err) => {\n\t\tres.status(400).send();\n\t\tconsole.log(err);\n\t});\n\n});\n\napp.patch('/todos/:id', authenticate, (req, res) => {\n\tconst id = req.params.id;\n\tconst body = _.pick(req.body, ['text', 'completed']);\n\n\tif (!ObjectID.isValid(id)) {\n\t\treturn res.status(404).send();\n\t}\n\n\tif (_.isBoolean(body.completed) && body.completed) {\n\t\tbody.completedAt = new Date().getTime();\n\t} else {\n\t\tbody.completed = false;\n\t\tbody.completedAt = null;\n\t}\n\n\tTodo.findOneAndUpdate({\n\t\t_id: id,\n\t\t_creator: req.user._id\n\t}, { $set: body\t}, {new: true})\n\t.then((todo) => !todo ? res.status(404).send() : res.send({todo}))\n\t.catch((err) => {\n\t\tres.status(400).send();\n\t\tconsole.log(err);\n\t});\n\n});\n\napp.post('/users', (req, res) => {\n\tconst body = _.pick(req.body, ['email', 'password']);\n\tconst user = new User(body);\n\n\tuser.save()\n\t.then((user) => {\n\t\treturn user.generateAuthToken();\n\t})\n\t.then((token) => {\n\t\tres.header('x-auth', token).send({user});\n\t})\n\t.catch((err) => {\n\t\tres.status(400).send(err);\n\t});\n});\n\napp.get('/users/me', authenticate, (req, res) => {\n\tres.send(req.user);\n});\n\napp.post('/users/login', (req, res) => {\n\tconst {email, password} = req.body;\n\n\tUser.findByCredentials(email, password)\n\t.then((user) => {\n\t\tif (!user) {\n\t\t\treturn res.status(400).send();\n\t\t}\n\n\t\treturn user.generateAuthToken()\n\t\t.then((token) => {\n\t\t\tres.header('x-auth', token).send({user});\n\t\t});\n\n\t})\n\t.catch(() => {\n\t\treturn res.status(400).send();\n\t});\n\n});\n\napp.delete('/users/me/token', authenticate, (req, res) => {\n\treq.user.removeToken(req.token)\n\t.then(() => {\n\t\tres.status(200).send();\n\t})\n\t.catch(() => {\n\t\tres.status(400).send();\n\t});\n});\n\napp.listen(port, () => {\n\tconsole.log(`Started server on port ${port}`);\n});\n\nmodule.exports = {\n\tapp\n};\n"]}